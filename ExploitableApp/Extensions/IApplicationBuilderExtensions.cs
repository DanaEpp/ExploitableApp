using System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;
using Microsoft.AspNetCore.Builder;
using Microsoft.AspNetCore.Identity;
using Microsoft.EntityFrameworkCore;
using Microsoft.AspNetCore.Hosting;
using Microsoft.Extensions.Configuration;
using Microsoft.Extensions.DependencyInjection;
using ExploitableApp.Data;
using ExploitableApp.Models;
using ExploitableApp.Services;

namespace ExploitableApp.Extensions
{
    public static class IApplicationBuilderExtensions
    {
        public static void UseFakeResponseHeaders(this IApplicationBuilder app)
        {
            app.Use(async (context, nextMiddleware) => {
                //Sometimes things can be misconfigured in a way that causes content disclosures, we want to leave this as a hint
                //https://www.exploit-db.com/exploits/19033/
                context.Response.OnStarting(() =>
                {
                    context.Response.Headers.Add("Server", "Microsoft-IIS/7.5");
                    context.Response.Headers.Add("X-Powered-By", "ASP.NET & PHP/5.2.13");
                    return Task.FromResult(0);
                });

                await nextMiddleware();
            });
        }
    }
}
